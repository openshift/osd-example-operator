# THIS FILE IS GENERATED BY BOILERPLATE. DO NOT EDIT.
apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: osde2e-focused-tests
parameters:
  - name: OSDE2E_CONFIGS
    required: true
  - name: TEST_IMAGE
    required: true
  - name: OCM_CLIENT_ID
    required: false
  - name: OCM_CLIENT_SECRET
    required: false
  - name: OCM_CCS
    required: false
  - name: AWS_ACCESS_KEY_ID
    required: false
  - name: AWS_SECRET_ACCESS_KEY
    required: false
  - name: CLOUD_PROVIDER_REGION
    required: false
  - name: GCP_CREDS_JSON
    required: false
  - name: JOBID
    generate: expression
    from: "[0-9a-z]{7}"
  - name: IMAGE_TAG
    value: ''
    required: true
  - name: LOG_BUCKET
    value: 'osde2e-logs'
  - name: USE_EXISTING_CLUSTER
    value: 'TRUE'
  - name: CAD_PAGERDUTY_ROUTING_KEY
    required: false
  - name: GEMINI_API_KEY
    required: false
  - name: SLACK_CHANNEL
    required: false
  - name: LOG_ANALYSIS_SLACK_WEBHOOK
    required: false
  - name: SLACK_NOTIFY
    required: false
objects:
  - apiVersion: batch/v1
    kind: Job
    metadata:
      name: osde2e-oeo-${IMAGE_TAG}-${JOBID}
    spec:
      backoffLimit: 0
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: osde2e
              image: quay.io/redhat-services-prod/osde2e-cicada-tenant/osde2e:latest
              command:
                - /osde2e
              args:
                - test
                - --only-health-check-nodes
                - --skip-destroy-cluster
                - --skip-must-gather
                - --log-analysis-enable
                - --configs
                - ${OSDE2E_CONFIGS}
              securityContext:
                runAsNonRoot: true
                allowPrivilegeEscalation: false
                capabilities:
                  drop: ["ALL"]
                seccompProfile:
                  type: RuntimeDefault
              env:
                - name: TEST_SUITES_YAML
                  value: |-
                    - image: ${TEST_IMAGE}:${IMAGE_TAG}
                      slackChannel: ${SLACK_CHANNEL}
                - name: OCM_CLIENT_ID
                  valueFrom:
                    secretKeyRef:
                      name: osde2e-ocm-credentials
                      key: ocm-client-id
                - name: OCM_CLIENT_SECRET
                  valueFrom:
                    secretKeyRef:
                      name: osde2e-ocm-credentials
                      key: ocm-client-secret
                - name: AWS_ACCESS_KEY_ID
                  valueFrom:
                    secretKeyRef:
                      name: osde2e-aws-credentials
                      key: aws-access-key-id
                - name: AWS_SECRET_ACCESS_KEY
                  valueFrom:
                    secretKeyRef:
                      name: osde2e-aws-credentials
                      key: aws-secret-access-key
                - name: GEMINI_API_KEY
                  valueFrom:
                    secretKeyRef:
                      name: osde2e-gcp-credentials
                      key: gemini-api-key
                - name: LOG_ANALYSIS_SLACK_WEBHOOK
                  valueFrom:
                    secretKeyRef:
                      name: osde2e-ocm-credentials
                      key: log-analysis-slack-webhook
                - name: OCM_CCS
                  value: ${OCM_CCS}
                - name: CLOUD_PROVIDER_REGION
                  value: ${CLOUD_PROVIDER_REGION}
                - name: GCP_CREDS_JSON
                  value: ${GCP_CREDS_JSON}
                - name: LOG_BUCKET
                  value: ${LOG_BUCKET}
                - name: USE_EXISTING_CLUSTER
                  value: ${USE_EXISTING_CLUSTER}
                - name: CAD_PAGERDUTY_ROUTING_KEY
                  valueFrom:
                    secretKeyRef:
                      name: osde2e-pagerduty-credentials
                      key: cad-pagerduty-routing-key
                - name: SLACK_NOTIFY
                  value: ${SLACK_NOTIFY}
